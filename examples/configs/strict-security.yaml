# Strict Security Configuration
# Enforces strict security best practices and fails on warnings
# For production IAM policies in high-security environments

settings:
  fail_fast: false
  max_concurrent: 10
  enable_builtin_checks: true
  parallel_execution: true

  # AWS services configuration
  aws_services_dir: null # Use AWS API (default)
  cache_enabled: true
  cache_ttl_hours: 168

  # Fail on more severity levels for strict security
  fail_on_severity:
    - error # IAM validity errors
    - critical # Critical security issues
    - high # High severity security issues
    - medium # Medium severity issues (stricter than default)

# Wildcard action check - elevated severity
wildcard_action:
  enabled: true
  severity: high # Elevated from default medium

# Wildcard resource check - elevated severity, minimal allowed wildcards
wildcard_resource:
  enabled: true
  severity: high # Elevated from default medium
  allowed_wildcards:
    - cloudwatch:Describe*
    - cloudwatch:Get*
    - cloudwatch:List*
    - ec2:Describe*
    - iam:Get*
    - iam:List*
    - logs:Describe*
    - logs:Get*
    - s3:List*

# Full wildcard check - both Action and Resource are "*"
full_wildcard:
  enabled: true
  severity: critical

# Service wildcard check - only allow logs and cloudwatch
service_wildcard:
  enabled: true
  severity: high
  allowed_services:
    - logs
    - cloudwatch

# Sensitive action check - elevated severity
sensitive_action:
  enabled: true
  severity: high # Elevated from default medium

# Action condition enforcement - strict requirements
action_condition_enforcement:
  enabled: true
  severity: critical # Elevated from default high

  requirements:
    # iam:PassRole MUST have iam:PassedToService condition
    - actions:
        - iam:PassRole
      severity: critical
      required_conditions:
        - condition_key: iam:PassedToService
          description: "Restrict which AWS services can assume the passed role to prevent privilege escalation"
          example: |
            "Condition": {
              "StringEquals": {
                "iam:PassedToService": [
                  "lambda.amazonaws.com",
                  "ecs-tasks.amazonaws.com",
                  "ec2.amazonaws.com"
                ]
              }
            }

    # IAM write operations MUST have permissions boundary
    - actions:
        - iam:CreateRole
        - iam:PutRolePolicy
        - iam:AttachRolePolicy
        - iam:PutUserPolicy
        - iam:AttachUserPolicy
      severity: critical
      required_conditions:
        - condition_key: iam:PermissionsBoundary
          description: "Require permissions boundary for sensitive IAM operations to prevent privilege escalation"
          expected_value: "arn:aws:iam::*:policy/DeveloperBoundary"
          example: |
            "Condition": {
              "StringEquals": {
                "iam:PermissionsBoundary": "arn:aws:iam::123456789012:policy/XCompanyBoundaries"
              }
            }

    # Sensitive S3 operations require HTTPS
    - actions:
        - s3:PutObject
        - s3:DeleteObject
        - s3:PutBucketPolicy
      severity: high
      required_conditions:
        - condition_key: aws:SecureTransport
          description: "Require HTTPS for S3 operations to prevent data interception"
          expected_value: true
          example: |
            "Condition": {
              "Bool": {
                "aws:SecureTransport": "true"
              }
            }

# This configuration provides enterprise-grade security enforcement
# Use this for production IAM policies in high-security environments
