Version: "2012-10-17"
Statement:
  - Sid: ListAllBuckets
    Effect: Allow
    Action:
      - s3:ListAllMyBuckets
      - s3:GetBucketLocation
    Resource: "*"

  - Sid: ManageObjectsInBucket
    Effect: Allow
    Action:
      - s3:GetObject
      - s3:PutObject
      - s3:DeleteObject
      - s3:GetObjectVersion
      - s3:DeleteObjectVersion
    Resource:
      - arn:aws:s3:::my-app-bucket/*
      - arn:aws:s3:::my-backup-bucket/*

  - Sid: ManageBucketContents
    Effect: Allow
    Action:
      - s3:ListBucket
      - s3:GetBucketVersioning
      - s3:ListBucketVersions
      - s3:ListBucketMultipartUploads
    Resource:
      - arn:aws:s3:::my-app-bucket
      - arn:aws:s3:::my-backup-bucket
    Condition:
      StringLike:
        s3:prefix:
          - home/${aws:username}/*
          - shared/*

  - Sid: ManageEncryption
    Effect: Allow
    Action:
      - s3:PutEncryptionConfiguration
      - s3:GetEncryptionConfiguration
    Resource:
      - arn:aws:s3:::my-app-bucket
    Condition:
      StringEquals:
        aws:RequestedRegion:
          - us-east-1
          - us-west-2

  - Sid: RequireMFAForDelete
    Effect: Allow
    Action:
      - s3:DeleteBucket
    Resource: arn:aws:s3:::my-app-bucket
    Condition:
      Bool:
        aws:MultiFactorAuthPresent: "true"
